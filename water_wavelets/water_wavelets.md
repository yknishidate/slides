# Water Surface Wavelets

STEFAN JESCHKE, NVIDIA

TOMÁŠ SKŘIVAN, IST Austria

MATTHIAS MÜLLER-FISCHER, NVIDIA

NUTTAPONG CHENTANEZ, NVIDIA

MILES MACKLIN, NVIDIA

CHRIS WOJTAN, IST Austria

最先端のリアルタイム2次元水面波シミュレーションでは、開発者は「効率的だが移動する障害物との相互作用を扱えないフーリエベース手法」と、「環境との相互作用は扱えるが計算コストが大幅に高い有限差分法／有限要素法」のどちらかを選ばざるを得ません。本論文は、移動する障害物との波の相互作用をリアルタイムに忠実にシミュレートしつつ、微細なディテールも保ち、非常に大きなシミュレーション領域にも対応できる新しい波シミュレーション手法を提案することで、この複雑さと性能の間に長らく存在してきたギャップを埋めることを目指します。  

従来の2D水面波シミュレーション手法は、水面高さの変化を直接計算しますが、この戦略はCFL条件（速い波には小さなタイムステップが必要）と、ナイキスト限界（小さな波のディテールには密なシミュレーション変数配置が必要）による制約を受けます。そこで本論文は、液体の運動を「空間・周波数・方向」にわたって変化する“振幅に似た関数”で離散化する、新しいウェーブレット変換を提案します。これはフーリエベース手法を局所的相互作用まで扱えるように一般化したものです。これらの新しい変数は元の水面高さ関数よりも空間的にずっとゆっくり変化するため、変数変換によってCFL条件とナイキスト限界の制約を大幅に緩和し、非常に高い見た目解像度で高度に詳細な水面波をシミュレートできるようになります。さらに、この離散化は高速な総和計算に適し、並列化も容易です。加えて、事前計算した波の経路や、双方向の固体–流体カップリングといった基本的拡張も示します。最後に、この離散化がアート的な操作（演出）に便利な変数系を提供することを主張し、新しい「波を描く」インタフェースでそれを例示します。 

## 1 INTRODUCTION

本論文は、大規模な水面波について、効率的で物理的にもっともらしいアニメーション生成とアートディレクションを扱う。現在この問題に対する解決策としては、（浅水方程式や分散波動方程式のような）偏微分方程式の数値解法、あるいはフーリエ変換に基づく解析的手法が用いられている。数値解法は移動する障害物との水の相互作用を扱うのが得意だが、小さな（高周波の）波のディテールを保ったまま非常に大きなシミュレーション領域へスケールさせると計算コストが高くなる。逆に、フーリエ総和（Fourier summation）技術は、高周波ディテールを伴う非常に大きな領域のシミュレーションを得意とする一方で、移動境界や空間的に変化する風のような複雑な環境相互作用を容易には組み込めない。 

本研究では、水面波計算を高速化するための新しい変換を提案する。従来の有限差分法のように格子上の各点で波高と運動量を離散化するのでもなく、従来のフーリエベース手法のように周波数と方向の関数として波の振幅を離散化するのでもなく、空間・周波数・方向を同時に変数として波の振幅を離散化するウェーブレット変換を導入する。この離散化で得られる変数は、元の水面波高関数よりも空間的にずっとゆっくり変化するため、同じ量の情報をより少ない変数で表現できる。さらに、この低周波なシミュレーションは、CFL条件やナイキスト限界といった従来の「周波数に基づく制約」に対して感度が低い。これらの制約は最大空間周波数を、タイムステップの大きさや見た目のディテールに対する制限へと変換してしまうが、提案離散化ではその影響を抑えられる。その結果、本離散化は（フーリエベース手法のような）高解像度の波ディテールと、移動する障害物との局所的な波の相互作用の両方を可能にする。 

また、これらの局所的で周波数依存の振幅を空間内で伝播させるための新しい方程式を導出する。得られる方程式は単純な2次元の移流（advection）と拡散（diffusion）操作になり、グラフィックスハードウェア上で容易に並列化できるため、対話的なフレームレートを実現できる。さらに、事前計算された波の経路（pre-computed wave paths）や、双方向の固体–流体カップリング（two-way solid fluid coupling）など、シミュレータの基本的拡張も示す。最後に、この新しい表現が複雑な海洋シミュレーションの動きを手作業で調整するのに便利なアート向けインタフェースを提供することを見いだし、シミュレーションの初期化やスクリプトによる動きで物理を上書きするための、波を描く（wave-painting）インタフェースのプロトタイプを示す。 

本論文の貢献は以下の通りである。 

* **Eulerian Wavelet Transformation（オイラー型ウェーブレット変換）**：ゆっくり変調された波（slowly modulated waves）の理論に基づく、水面波輸送のための新しい理論モデル。 
* **低周波のシミュレーション変数**：水面高さそのものよりも空間的にゆっくり変化する関数に基づいて離散化するため、より低解像度の格子で表現できる。この変数変換により、計算をより効率化し、より大きな計算領域（Figure 1）を扱える。 
* **新しいアート的制御**：物理運動方程式で振幅関数を決めることに加え、アート的効果のためにこれらの波の振幅を上書きすることも試す。本手法を用いることで、従来研究よりも速く・容易に波シーンを事前計算できることを示し、空間的に変化する海洋波を設計するための対話的ペイントUIを提示する。 

## 2 関連研究（RELATED WORK）

コンピュータアニメーションの黎明期（Schachter 1980）以来、水面形状とその運動を復元するための主要な戦略は、ナビエ–ストークス方程式を近似的に解くことでした。これらの方程式を近似する方法は数多く存在し、本節では手法を、解析的な「スペクトルベース」アプローチ、偏微分方程式（PDE）の直接的な数値シミュレーション、そしてハイブリッド手法に分類して議論します。最後に、波のシミュレーションをアートディレクションするための方法について述べます。 

### スペクトルベースのアプローチ（Spectrum-based approaches）

物理学およびコンピュータグラフィックスの両分野では、ナビエ–ストークス方程式に対して多くの理論的仮定を置くことで複雑さを減らし、解析的に扱える形にしています。コンピュータグラフィックスで一般的な仮定としては、深水、ポテンシャル流れ、小振幅、周期境界条件などがあります。これらのアプローチは、2Dの高さ場におけるナビエ–ストークス方程式の解析解を利用し、海の運動を正弦・余弦の形で表現しますが、任意の流体運動をシミュレートする能力は犠牲にします（Hinsinger et al. 2002; Horvath 2015; Mastin et al. 1987; Tessendorf 2004b）。Jeschke & Wojtan（2015）は、静的な環境内で波面の伝播をシミュレートすることで、複雑な境界を扱えるようスペクトルベース手法を拡張しました。しかし、この手法は事前計算に限定され、移動する障害物との相互作用は扱えません。 

本論文では、フーリエ変換を離散化するこの種の手法を「スペクトルベース」アプローチと呼びます。これらの手法は理論上、視覚的ディテールに上限がありません。すなわち、任意に高周波な波をアニメーションしても、手法の精度や安定性に影響しないという意味です。同様に、波速が速い場合でも、運動がタイムステップ幅に依存しないためシミュレーションは容易です。一方で、導出において基礎となる流れに複数の仮定を置くため、複雑な境界と現実的に相互作用できない、といった制約が生じがちです。 

### PDEの数値解（Numerical solutions to Partial Differential Equations）

スペクトルベース手法の制約を回避する有力な方法は、ナビエ–ストークス方程式の2次元版を数値アルゴリズムで直接シミュレートすることです。簡略化した波動方程式（Kass and Miller 1990; Thuerey et al. 2010; Yang et al. 2016）や薄板方程式（Yu et al. 2012）を離散化する手法もあります。これらの簡略化方程式は実装しやすい一方で、得られる挙動は実際の水波とは本質的に異なります。Tessendorf（2004a; 2014）は線形化ベルヌーイ方程式を離散化し、より現実的な分散を示しますが、それでも物理的に正しい運動には至りません（Canabal et al. 2016で議論）。また、格子ボルツマン法（LBM）に基づく直接数値シミュレータ（Geist et al. 2010）も提案されていますが、現実的な波速を得るにはLBMの衝突行列を注意深く調整する必要があります。畳み込みベース手法（Loviscach 2002; Ottosson 2011）は正しい分散関係の実現を狙いますが、巨大なカーネルがシミュレーション領域全体を占有してしまう実装上の難しさに直面します。近年、Canabal et al.（2016）はピラミッドフィルタと「影付き」畳み込み演算を組み合わせて、これらの困難を克服しました。 

これらの手法は、環境に関する仮定が少ないため、スペクトルベース手法より柔軟である傾向があります。たとえば、スペクトルベース手法は周期境界を仮定して導出されるため障害物相互作用が苦手ですが、直接シミュレーション手法にはその制約がありません。一方で、これらの手法では、時間パラメータを余弦関数に代入するだけで済むわけではなく、局所カーネル演算を反復して波の伝播を表現する必要があります。これらの手法はいずれも、波高と運動量をオイラー的な格子／メッシュ上に直接離散化するため、格子の解像度が波の可視ディテール量に直結します。ナイキストの定理により、高さ場の最高周波数を解像できるだけ格子を細かくしなければ、エイリアシングや不安定性が生じ得ます。同様に、陽解法で積分する波シミュレーションの安定性はCFL条件によって格子間隔と密接に結び付けられます。これは陰解法によって回避できますが、追加計算と、より複雑でGPU向きでない実装を代償として支払うことになります。 

液体の完全3次元シミュレーション手法は本研究の範囲外です。関心のある読者には Bridson（2015）の書籍を参照することを推奨します。 

### ハイブリッド手法（Hybrid approaches）

本手法は、数値手法の柔軟性と、スペクトルベース手法の安定性・視覚的ディテールを組み合わせますが、同様の方向性は既に存在します。Yuksel et al.（2007）は、局所的な波頂を表し、所定の波速 (c) で移動する wave particles を提案しました。粒子サイズを多数用意し、(c) を解析的な位相速度に等しく設定すれば、このアプローチは局所的なスペクトルベース手法として見なせます。さらに Jeschke & Wojtan（2017）は、理論的な群速度で伝播し、理論的な位相速度で進む短い波列を内部に含む wave packets を導入しました。これらは、数値的安定性や理論的に正しい波速といったスペクトルベース手法の利点の一部を継承します。同時に、全域に広がる余弦波を短い波成分の列へ分割することで、障害物と相互作用できるようになり、スペクトルベース波の扱いにくさを回避します。本手法も同様の利点を提供しますが、ラグランジュ的ではなくオイラー的です（自由度が波の運動そのものではなく、空間領域に紐づく）。その結果、GPUハードウェアへより自然にマッピングでき、粒子数に依存しない一定の計算量となり、さらにテクスチャマップと容易に接続できるためアート制御にも都合が良い、という特徴があります。 

### 波のアートディレクション（Art-directing waves）

既存研究では、キーフレームを直接編集する（McNamara et al. 2004; Shi and Yu 2005）、流体を対話的に彫刻する（Manteaux et al. 2016; Pan et al. 2013）、粒子やメッシュにガイド力を導入する（Thuerey et al. 2009; Raveendran et al. 2012）、便利な流れプリミティブを合成する（Chenney 2004）、シミュレーション間や既存モーション間で補間する（Raveendran et al. 2014; Thuerey 2016）など、多様な液体制御手法が検討されてきました。また、既存アニメーションに対して表面上（Angst et al. 2008; Kim et al. 2013）や境界近傍（Jeschke and Wojtan 2015, 2017）へ追加の波を付与する研究もあります。Horvath（2015）は海洋スペクトルの制御を詳細に探究し、Nielsen et al.（2013）はスクリプト化された高さ場に基づいてスペクトルベース手法を制御する方法を調査しています。私たちの知る限り、本論文が提案するように、方向性をもつ水波の振幅を局所的にディレクションする先行手法は存在しません。 
