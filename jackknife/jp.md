モンテカルロボリュームレンダリングにおける中心的な操作の一つは、透過率推定です。光線に沿ったある区間が与えられたとき、その区間を吸収や散乱を受けることなく通過する光の割合を推定することが目標となります。単純なアプローチは、不偏なレイマーチングを用いて光学的深さτを推定し、その後exp(−τ)を透過率の推定値として用いることです。しかし、この戦略はイェンセンの不等式により、透過率を系統的に過大評価してしまいます。一方、既存の不偏透過率推定器は、高分散に悩まされるか、ランダムな決定に依存するコストがかかるため、SIMDアーキテクチャにはあまり適していません。そこで本稿では、単純なアプローチと比較してバイアスを大幅に低減し、決定論的で低コストなバイアス付き透過率推定器を提案します。層化ジッタリングサンプリングを用いたレイマーチングによって得られる光学的深さの推定値が、ほぼ正規分布に従うことを観察しました。そこで、このような2つの推定値（2つの異なる乱数系列を使用）に基づいて、exp(−τ)の唯一の最小分散不偏推定器（UMVU推定器）を適用します。バイアスは、入力が正規分布に従うという仮定が破られた場合にのみ発生します。さらに、分散を考慮した重点サンプリングスキームを用いて、バイアスと分散を低減します。この基礎となる理論は、光学的深さの任意解析関数の推定に用いることができます。この一般化を用いて、多重重点サンプリング（MIS）重みを推定し、2つの積分器を導入します。1つはバイアス付きMIS重みを用いた不偏MIS、もう1つはより効率的ですがバイアスのあるMISと透過率推定の組み合わせです。

# 1 Introduction

霧、蒸気、煙などの散乱媒体における物理ベースのボリュームレンダリングは困難です。このような媒体が存在する場合、2つの表面相互作用間の光線に沿った放射輝度は一定ではなくなります。代わりに、光の吸収、散乱、および放出を考慮するために、光線に沿った積分を推定する必要があります。これらの効果は、多くの点で表面レンダリングと同様に処理できます。例えば、単方向パストレーサーを使用するなどです。大きな違いは、距離サンプリングと透過率推定がレイトレーシングの代わりとなる点です[Novák et al. 2018]。距離サンプリングは次のパス頂点までの距離を決定し、透過率推定は特定の光線セグメントに沿ってボリュームを通過する光の割合を計算します。不均一な（つまり空間的に変化する）媒体の場合、これらの2つの操作は、レンダラーがボリュームデータと相互作用する主要な方法であるため、ボリュームレンダリング全体のコストに大きく影響します。

本研究における主な貢献は、透過率推定のための効率的かつGPUに優しいソリューションです。光線セグメントに沿った減衰を $\mu(t)$ で表します。ここで𝑡∈[0,𝑡max]⊂Rは光線パラメータです。透過率は

$$
T := T(t_{max}) := \exp(-\tau), where \tau(t_{max}) := \int_0^{t_{max}} \mu(t) dt
$$

積分τは光学的深さと呼ばれる。透過率Tを推定する素朴なアプローチは、τの不偏モンテカルロ推定値Xを計算することである。例えば、一様ジッターサンプリングを用いたレイマーチングを用いる方法などがある[Kettunen et al. 2021; Pauly et al. 2000]。そして、exp(−X)を透過率の推定値として使用する。しかしながら、この戦略は透過率を系統的に過大評価してしまう。なぜなら、イェンセンの不等式により、期待値は以下の関係を満たすからである。

$$
E(\exp(-X)) \geq \exp(E(-X)) = \exp(-\tau) = T
$$

不偏透過率推定器には主に3つの種類があります。レギュラートラッキング[Amanatides and Woo 1987; Szirmay-Kalos et al. 2010]は、τを正確に計算するために高い計算コストがかかります。ヌル衝突法[Coleman 1968; Novák et al. 2014]は、均質化された媒質を確率的に走査し、元の媒質との差に基づいて透過率を推定します。不偏レイマーチング[Georgiev et al. 2019; Kettunen et al. 2021]は、確率的に選択された無制限の数の独立した光学的深さ推定値を組み合わせて、べき級数

$$
\exp(-\tau) = \sum_{j=0}^{\infty} \frac{(-\tau)^j}{j!}
$$

を推定します。正規トラッキングは予測可能ですがコストが高くなります。他の2つのアプローチは、実行される作業量がランダムであるため、GPU上での実行が発散しやすいという問題があります。さらに、ヌル衝突法は比較的高い分散を示します。

同時に、GPU上でのリアルタイムボリュームレンダリングが実現可能になりつつあり、効率的でGPUに適したアルゴリズムへの需要が高まっています[Hofmann et al. 2021, 2023; Schneider 2023]。このような状況では、多少のバイアスは許容範囲内です。しかし、exp(−𝑋)という推定値は最適とは言えないようです。バイアスが常に正であるという事実は、より良い推定値が存在する可能性を示唆しています。バイアスは𝑋の分散とともに増加します。もし何らかの方法でバイアスを正確に推定できれば、それを補正することでより良い透過率推定値を得ることができるでしょう。

これを実現するために、私たちは一つの重要な仮定に基づいています。それは、光学的深さの推定値が正規分布、すなわちガウス密度で分布しているという仮定です（3.1節）。この仮定の下では、exp(−𝜏) の一意な最小分散不偏推定量（UMVU推定量）が知られています。これは、いわゆる一般化ジャックナイフ法を用いて導出されたものです[Gray et al. 1973]（3.2節）。私たちは、光学的深さの2つの不偏で独立同分布（i.i.d.）な推定値X₀、X₁を用いてこの推定量を使用します。つまり、同じ方法で光学的深さτを2回推定しますが、それぞれ異なる乱数を使用します。この選択の結果、私たちの新しいジャックナイフ透過率推定値に対して、驚くほどシンプルな以下の式が得られます（3.3節）。

$$
T \approx \cosh\left(\frac{X_0 - X_1}{2}\right) \exp\left(-\frac{X_0 + X_1}{2}\right).
$$

光学的深さの推定値が正規分布に従うという仮定の下では、この推定値は不偏です。実際には、この仮定は満たされないことが予想され、その結果バイアスが生じます。しかし、一様ジッターサンプリングの代わりに層化ジッターサンプリングを用いることで、このバイアスを小さく抑えることができます[Pauly et al. 2000]（4.1節）。このようにすることで、光学的深さの推定値は独立な確率変数の和となり、中心極限定理[Knight 1999, p. 145]により、サンプル数が増加するにつれて正規分布に近づきます。疎なボリュームが存在する場合でもこの推論の信頼性を高めるために、分散を考慮した[Pantaleoni and Heitz 2017]重点サンプリング手法を提案し（4.2節）、サンプル数を一定に保ちます（4.3節）。

我々の推定の基礎となる理論[Gray et al. 1973]は、exp(−𝜏)の推定に限定されるものではありません。任意の解析関数𝑔 : C → Cに対して𝑔(𝜏)を推定することができます（5.1節）。この機能を利用して、距離サンプリング手法、例えば自由飛行距離サンプリングと等角サンプリングを組み合わせる[Kulla and Fajardo 2012]といった、複数の重点サンプリング（MIS）を実装します。この際によく知られている問題は、自由飛行サンプリングの確率密度が𝑇(𝑡)𝜇(𝑡)であり、正確には既知ではないことです[Miller et al. 2019; Novák et al. 2018]。この問題には2つの方法で対処します（5.2節）。1つは、MIS重みをバイアスのかかった方法で推定する方法です。この場合でも、最終的なMIS推定値は不偏になります[Veach and Guibas 1995]。もう1つは、MIS重み、逆密度、透過率の積を直接推定する方法です。これにより全体的な計算コストは​​削減されますが、わずかなバイアスが生じます。

私たちの透過率推定方法は、既存のバイアスのある代替手法 [Kettunen et al. 2021] と比較してバイアスが大幅に低く、トラック長推定法や比率トラッキング法 [Novák et al. 2014] よりも分散が小さく、バイアスのないレイマーチング法 [Kettunen et al. 2021] よりも計算コストが低くなっています（6.1節）。また、私たちのMIS重み推定方法は、同等のサンプル数において、比率トラッキングに基づく手法 [Miller et al. 2019] と比較して分散が大幅に低減されています（6.2節）。GPU実装のソースコードはプロジェクトのウェブページで公開しています。

## 3.2 一意な最小分散不偏推定

exp(−𝑋)よりも優れた透過率推定値を構築するには、光学的深さの推定値が複数必要になります。そこで、光学的深さの独立同分布（i.i.d.）推定値を複数計算します。つまり、異なる乱数を用いて同じ推定値を複数回評価します。本アプローチでは、各推定値は未知の平均τと未知の標準偏差を持つ正規分布に従うと仮定します。そして、透過率𝑇 = exp(−τ)の不偏推定値を求めます。さらに、この推定値は最小の分散を持つことが望ましいです。つまり、最小分散不偏推定量（UMVU推定量）を求めたいのです。UMVU推定量は統計学においてよく研究されており、様々な統計量や𝑋の異なる分布について知られています[Voinov and Nikulin 1993]。私たちは、この特定の場合の解を文献[Gray et al. 1973, Example 4]に見つけました。

定理1. 𝑚 ∈ N で𝑚 ≥ 2とし、𝑋0, . . . ,𝑋𝑚−1 を、平均𝜏 ∈ R と標準偏差𝜎 ≥ 0が未知の正規分布のi.i.d.標本とする。標本平均、バイアス付き標本分散、バイアス付き標本標準偏差は次のように定義される。

$$
\bar{X} := \frac{1}{m} \sum_{j=0}^{m-1} X_j, \quad S^2 := \frac{1}{m} \sum_{j=0}^{m-1} X_j^2 - \bar{X}^2, \quad S := \sqrt{S^2}.
$$


$$
K := \Gamma\left(\frac{m-1}{2}\right)\left(\frac{2}{S}\right)^{\frac{m-3}{2}} J_{\frac{m-3}{2}}(S) \exp(-\bar{X}),
$$
